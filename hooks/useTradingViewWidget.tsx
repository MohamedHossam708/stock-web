'use client'; 


import { useEffect, useRef } from 'react';


const useTradingViewWidget = (
  scriptUrl: string,              // ๐น ุฑุงุจุท ุณูุฑุจุช TradingView (ูุซูุงู: embed-widget-market-overview.js)
  config: Record<string, unknown>,// ๐น ุฅุนุฏุงุฏุงุช ุงูุฃุฏุงุฉ (ูุซู ุงูุฃููุงูุ ุงูุฑููุฒุ ุงููุบุฉุ ุฅูุฎ)
  height = 600                    // ๐น ุงูุงุฑุชูุงุน ุงูุงูุชุฑุงุถู ููุฃุฏุงุฉ ุฅุฐุง ูู ูุชู ุชูุฑูุฑู
) => {

  // ๐งญ ูููุดุฆ ูุฑุฌุน (Ref) ูุนููุตุฑ ุงูู <div> ุงูุฐู ุณููุถุงู ุจุฏุงุฎูู ุงูุณูุฑุจุช ูุงุญูุงู
  const containerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    // ๐งฑ ูุฃุฎุฐ ุงููุฑุฌุน ุงูุญุงูู (ุงูุนูุตุฑ ุงููุนูู ูู ุงูู DOM)
    const container = containerRef.current;
    if (!container) return; // โ ุฅุฐุง ูู ููู ุงูุนูุตุฑ ููุฌูุฏุงูุ ูุง ููุนู ุดูุฆุงู

    // ๐งน ุชูุธูู ุงููุญุชูู ุงูุณุงุจู ุฏุงุฎู ุงูุนูุตุฑ ูุจู ุฅุถุงูุฉ ุงูุณูุฑุจุช ุงูุฌุฏูุฏ
    container.innerHTML = '';

    // ๐งฉ ุฅูุดุงุก ุนูุตุฑ <script> ุฌุฏูุฏ ูู ุงูู DOM
    const script = document.createElement('script');
    script.src = scriptUrl;          // ๐ ุชุญุฏูุฏ ูุตุฏุฑ ุงูุณูุฑุจุช (ูู TradingView)
    script.type = 'text/javascript'; // ๐ ุชุญุฏูุฏ ููุน ุงูุณูุฑุจุช
    script.async = true;             // โก ุชุญูููู ุจุดูู ุบูุฑ ูุชุฒุงูู ุญุชู ูุง ูููู ุงูุตูุญุฉ

    // ๐ง ููุชุจุฉ TradingView ุชุชุทูุจ ุฃู ูููู ุงูุฅุนุฏุงุฏ (config)
    // ุฏุงุฎู ุงูุณูุฑุจุช ููุณู ููุต JSONุ ูููุณ ูุฎุตุงุฆุต ุนุงุฏูุฉ
    script.innerHTML = JSON.stringify({
      ...config, // ๐ธ ููุณุฎ ุงูุฅุนุฏุงุฏุงุช ุงูููุฑุฑุฉ
      height,    // ๐ธ ูุถูู ุงูุงุฑุชูุงุน ุงูุญุงูู ุถูู ุงูุฅุนุฏุงุฏุงุช
    });

    // ๐งท ูุถูู ุงูุณูุฑุจุช ุงูุฐู ุฃูุดุฃูุงู ุฏุงุฎู ุนูุตุฑ ุงูู <div> ุงููุญุฏุฏ
    container.appendChild(script);

    // ๐งผ ุฏุงูุฉ ุงูุชูุธูู (ุชุนูู ุนูุฏ ุฅุฒุงูุฉ ุงููููู ูู ุงูุตูุญุฉ)
    return () => {
      // ๐งฝ ูุญุฐู ุฃู ูุญุชูู ุฏุงุฎู ุงูุนูุตุฑ ุญุชู ูุง ุชุจูู ุขุซุงุฑ ููุณูุฑุจุช ุงููุฏูู
      container.innerHTML = '';
    };

    // ๐ ูุฐุง ุงูู useEffect ุณููุนุงุฏ ุชุดุบููู ููุท ุฅุฐุง ุชุบููุฑ ุฃุญุฏ ูุฐู ุงูููู:
    // (ุฑุงุจุท ุงูุณูุฑุจุช - ุงูุฅุนุฏุงุฏุงุช - ุงูุงุฑุชูุงุน)
  }, [scriptUrl, config, height]);

  // ๐ฆ ููุฑุฌุน ุงููุฑุฌุน (Ref) ููุชู ุฑุจุทู ุจุนูุตุฑ ุงูู <div> ุฏุงุฎู ุงููููู ุงูุฑุฆูุณู
  return containerRef;
};

// ๐ ููุตุฏุฑ ุงูู Hook ุญุชู ูููู ุงุณุชุฏุนุงุคู ูู ุงูููููุงุช ุงูุฃุฎุฑู
export default useTradingViewWidget;
